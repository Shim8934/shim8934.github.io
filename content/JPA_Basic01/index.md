---
emoji: ğŸ˜„
title: JPA ê¸°ë³¸ ê°•ì˜ ì •ë¦¬ - 01. JPA ì‚¬ìš© ì´ìœ  & ì˜ì†ì„±
date: '2022-01-06 06:00:00'
author: shim8934
tags: JPA Java
categories: JPA_Basic
---
## JPA ?
### JPAì˜ ë“±ì¥ ë°°ê²½
#### â†’ Javaì™€  DB(RDBMS) ì˜ ì •ë³´ ì €ì¥ ë°©ì‹ì˜ ì°¨ì´
(1) Java - Javaì—ì„œ ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ ì—°ê´€ ë°ì´í„° ì¡°íšŒ
(2) RDBMS - í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ë¥¼ ì‚¬ìš©.

![difference](./difference.jpg)



* ì¦‰, ê¸°ì¡´ì˜ JDBC Template, Mybatis ë“±ì˜ ê¸°ìˆ ì´ ìˆì—ˆìŒì—ë„ ê°ì²´ ì§€í–¥ì ì¸ í”„ë¡œê·¸ë˜ë°ì´ ì•„ë‹Œ SQL ì¤‘ì‹¬ì ì¸ ê°œë°œì´ ë§ì€ ì‹œê°„ê³¼ ë…¸ë ¥ì„ ë“¤ì´ê²Œ ëë‹¤.
* ì•ì„œ ë‚˜ì˜¨ ê¸°ìˆ ë“¤ì˜ SQL ì¤‘ì‹¬ì ì¸ ê°œë°œ ìš”ì†Œë¥¼ ì¤„ì´ê³ ì Java Persistence API(ì´í•˜ JPA) ê°€ ë“±ì¥í•˜ê²Œ ëë‹¤.


---

## JPAì˜ íŠ¹ì§•

### 1. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

* ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½ (ì»¨í…Œì´ë„ˆ)

1) 1ì°¨ ìºì‹œ
1) ë™ì¼ì„± ë³´ì¥
1) íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°
1) ë³€ê²½ ê°ì§€
1) ì§€ì—° ë¡œë”©

---

#### 1) 1ì°¨ ìºì‹œ

* em.persist() ë¡œ ê°ì²´ê°€ 1ì°¨ ìºì‹œì— ì €ì¥ë˜ì§€ë§Œ, DBì— ì €ì¥ëœ ê²ƒì€ ì•„ë‹ˆë‹¤.

  â†’ ì´í›„ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•´ì•¼ ì‹¤ì œë¡œ DBì— ê°ì²´ ê´€ë ¨ ì¿¼ë¦¬ê°€ ì…ë ¥ë˜ê³ , ê·¸ ë•Œ ì €ì¥ëœë‹¤.

* ì¦‰, ì €ì¥ë˜ê¸° ì „ê¹Œì§„ ê°ì²´ì˜ ìƒíƒœì™€ ê´€ë ¨ëœ ë³€ê²½ì‚¬í•­ì´ ìˆì„ ê²½ìš°, ë³€ê²½ì‚¬í•­ì— ë”°ë¥¸ ì¿¼ë¦¬ë¥¼ JPAì—ì„œ ìë™ì ìœ¼ë¡œ ì„¤ì •í•´ ì¤€ë‹¤. (CRUD ê´€ë ¨)

```java
Member member = new Member();
member.setId("member1");
member.setUsername("íšŒì›1");

// 1ì°¨ ìºì‹œì— ì €ì¥
em.persist(member);

// 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒ
Member findMember = em.find(Memeber.class, "member1");
```

![temporarycache01](./temporarycache01.jpg)

---

#### 2) ë™ì¼ì„± ë³´ì¥

* 1ì°¨ ìºì‹œì— ì €ì¥ëœ ê°ì²´ëŠ” ë°˜ë³µ ê°€ëŠ¥í•œ ì½ê¸° ìƒíƒœë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì°¨ì›ì—ì„œ ì œê³µí•œë‹¤.

  â†’ 1ì°¨ ìºì‹œì— ì €ì¥ëœ ê°ì²´ì— í•œí•´, DBë¡œ ì¡°íšŒì¿¼ë¦¬ê°€ ë°˜ë³µì ìœ¼ë¡œ ë‚ ì•„ê°€ì§€ ì•ŠëŠ”ë‹¤.

```java
System.out.println("=== BEFORE ===");
Member a = em.find(Member.class,"member1");
Member b = em.find(Member.class,"member1");
System.out.println("a == b ? -> "+ (a == b));
System.out.println("=== AFTER ===");
```

![repetable-read.jpg](./repetable-read.jpg)

---

#### 3) íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°

(1) íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œê¹Œì§€ INSERT SQLì„ ëª¨ì•˜ë‹¤ê°€ íŠ¸ëœì­ì…˜ Commit ì‹œ, ìŒ“ì¸ Insert ì¿¼ë¦¬ë¥¼ ëª¨ì•„ì„œ ë³´ëƒ„. 

```java
EntityManager em = emf.createEntityManager();
EntityTransaction transaction = em.getTransaction();
transaction.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

em.persist(memberA);
em.persist(memberB);
// â†‘ ìœ„ê¹Œì§€ëŠ” ì¿¼ë¦¬ë¬¸ì´ ì‘ì„±ë˜ì§€ ì•ŠëŠ”ë‹¤. (1ì°¨ìºì‹œ ì˜ì—­)

// â†“ commit ìˆœê°„ DBì— ì¿¼ë¦¬ë¬¸ì´ ì‘ì„±ëœë‹¤.
transaction.commit(); // íŠ¸ëœì­ì…˜ ì»¤ë°‹
```

![transaction-commit](./transaction-commit.jpg)

---

#### 4) ë³€ê²½ ê°ì§€

```java
EntityManager em = emf.createEntityManager();
EntityTransaction transaction = em.getTransaction();
transaction.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

// ì—”í‹°í‹° ì¡°íšŒ
Member memberA = em.find(Member.class, "memberA");

// ì—”í‹°í‹° ë°ì´í„° ìˆ˜ì •
memberA.setUsername("JPA");
memberA.setAge(32);

transaction.commit(); // íŠ¸ëœì­ì…˜ ì»¤ë°‹
```

* ìœ„ ì˜ˆì‹œ ì½”ë“œì²˜ëŸ¼ ë°ì´í„° ìˆ˜ì •ì´ ìˆì„ ì‹œ, ê¸°ì¡´ JDBCì—ì„œëŠ” Java ì½”ë“œì—ì„œë„ update() ê´€ë ¨ ì½”ë“œë¥¼ ì‘ë™í•´ì•¼ í–ˆë‹¤.

  â€‹	â†’ JPAì—ì„  ì—”í‹°í‹°ì˜ 1ì°¨ ìºì‹œì— ì¡°íšŒëì„ ë‹¹ì‹œì™€ ë¹„êµí•´ ë³€ê²½ì´ ê°ì§€ë  ì‹œ, ìë™ìœ¼ë¡œ ê´€ë ¨ Update ë¬¸ì„ ì‘ì„±í•´ DBì— ë³´ë‚¸ë‹¤.

* ì˜ˆì™¸ì ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´, ë³€ê²½ ê´€ë ¨ ì¿¼ë¦¬ ì—­ì‹œ ìœ„ì˜ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°ê³¼ ë™ì¼í•œ íƒ€ì´ë°ì— ì‘ë™í•œë‹¤. (commit ì‹œ).

![DirtyChecking](./DirtyChecking.jpg)

---
### 2. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ í”ŒëŸ¬ì‹œ

* ì˜ì†ì„ ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ë‚´ìš©ì„ DBì— ë°˜ì˜í•˜ëŠ” ê²ƒì„ ì˜ë¯¸.

#### 1) í”ŒëŸ¬ì‹œ ë°œìƒ ê²½ìš°

1. ë³€ê²½ ê°ì§€ (Dirty Checking) ë¡œ ì €ì¥ì†Œì˜ ì¿¼ë¦¬ë¥¼ DBì— ì „ì†¡í•œ ê²½ìš°.

#### 2)  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•˜ëŠ” ë°©ë²•.

1. em.flush() - ì§ì ‘ í˜¸ì¶œ.
2. íŠ¸ëœì­ì…˜ ì»¤ë°‹ - í”ŒëŸ¬ì‹œ ìë™ í˜¸ì¶œ.
3. JPQL ì¿¼ë¦¬ ì‹¤í–‰ - í”ŒëŸ¬ì‹œ ìë™ í˜¸ì¶œ.

---


```toc

```